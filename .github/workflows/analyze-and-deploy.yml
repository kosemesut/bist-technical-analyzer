name: BIST Teknik Analiz - Otomatik Rapor

on:
  # Her 15 dakikada bir Ã§alÄ±ÅŸ
  schedule:
    - cron: '*/15 * * * *'
  
  # Manuel tetikleme - istediÄŸin zaman Ã§alÄ±ÅŸtÄ±r
  workflow_dispatch:
  
  # Push'larda da Ã§alÄ±ÅŸsÄ±n (isteÄŸe baÄŸlÄ±)
  push:
    branches: [ main ]

jobs:
  analyze-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write
    
    steps:
    - name: ğŸ“¥ Kodu indir
      uses: actions/checkout@v4
    
    - name: â˜• Java 17 kur
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
    
    - name: ğŸ”¨ Projeyi derle
      run: mvn clean package -DskipTests -q
    
    - name: ğŸ“Š Analiz Ã§alÄ±ÅŸtÄ±r ve rapor oluÅŸtur
      run: |
        echo "BIST hisselerini analiz ediliyor..."
        java -jar target/bist-technical-analyzer-1.0.0.jar
        echo "âœ… Analiz tamamlandÄ±!"
        
    - name: ğŸ“ Rapor dosyalarÄ±nÄ± kontrol et
      run: |
        ls -la output/
        echo "Report dosyasÄ± var mÄ±?"
        test -f output/report.html && echo "âœ… report.html oluÅŸturuldu" || echo "âŒ report.html bulunamadÄ±"
    
    - name: ğŸ“„ DosyalarÄ± docs klasÃ¶rÃ¼ne kopyala (GitHub Pages iÃ§in)
      run: |
        mkdir -p docs
        cp output/report.html docs/index.html || true
        cp -r output/charts docs/ || true
    
    - name: ğŸŒ GitHub Pages'e deploy et
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs
        publish_branch: gh-pages
        force_orphan: true
        user_name: 'github-actions[bot]'
        user_email: 'github-actions[bot]@users.noreply.github.com'
        commit_message: 'GÃ¼ncel BIST analiz raporu'
    
    - name: ğŸ‰ BaÅŸarÄ±lÄ±
      run: |
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "âœ… Rapor baÅŸarÄ±yla yayÄ±nlandÄ±!"
        echo "ğŸ”— Rapor linki: https://kosemesut.github.io/bist-technical-analyzer/report.html"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
